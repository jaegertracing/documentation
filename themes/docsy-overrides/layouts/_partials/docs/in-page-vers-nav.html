{{ $page := . -}}
{{ $path     := "" }}
{{ with .File }}
  {{ $path = .Path }}
{{ else }}
  {{ $path = .Path }}
{{ end }}
{{ $latestV1      := site.Params.latest }}
{{ $latestV2      := site.Params.latestV2 }}
{{ $version       := index (split $path "/") 1 }}
{{ $vMajor        := index (split $version ".") 0 }}
{{ $isNextRelease := false }}
{{ if hasSuffix $version "dev" }}
  {{ $isNextRelease = true }}
{{ else if eq $version "next-release" }}
  {{ $vMajor = "1" }}
  {{ $isNextRelease = true }}
{{ else if eq $version "next-release-v2" }}
  {{ $vMajor = "2" }}
  {{ $isNextRelease = true }}
{{ end }}

{{ $isArchive     := eq $version $latestV1 }}
{{ $isLatest      := eq $version $latestV2 }}
{{ $latestUrlV1   := .RelPermalink | replaceRE $version $latestV1 }}
{{ $latestUrlV2   := .RelPermalink | replaceRE $version $latestV2 }}

{{ $latestUrl := "" }}
{{ if eq $vMajor "1" }}
  {{ $latestUrl = .RelPermalink | replaceRE $version $latestV1 }}
{{ else if eq $vMajor "2" }}
  {{ $latestUrl = .RelPermalink | replaceRE $version $latestV2 }}
{{ else if eq $vMajor "docs" }}
  {{ $latestUrl = .RelPermalink | replaceRE $version $latestV2 }}
  {{ $vMajor    = "2" }}
{{ end }}

{{ $latestUrl = partial "docs/lookup-page" (slice . $latestUrl) -}}
{{ $latestUrlV1 = partial "docs/lookup-page" (slice . $latestUrlV1) -}}
{{ $latestUrlV2 = partial "docs/lookup-page" (slice . $latestUrlV2) -}}
{{ $btnKind :=
    cond $isNextRelease "secondary"
      (cond $isLatest "success" "warning") -}}
{{ $versionQualifier :=
    cond $isNextRelease "preview"
      (cond $isLatest "latest"
      (cond $isArchive "archive" "outdated")
    )
-}}

{{ if and (hasPrefix $path "docs/") (ne $path "docs/_index.md") }}
<div class="mb-1">
  <div class="btn-group border border-dark-subtle">

    <span class="btn btn-sm btn-{{ $btnKind }} pe-none" {{/**/ -}}
      title="This is the current version">
      <span class="fw-bold pe-2">Version</span>
      {{- /**/ -}}
      <span class="fw-bold">{{ $version }}</span>
      {{ with $versionQualifier }} ({{ . }}) {{- end -}}
    </span>

    {{ if and $latestUrlV2 (or (ne $vMajor "2") (not $isLatest)) }}
    <a class="btn btn-sm btn-light border-0 border-start border-dark-subtle" {{/**/ -}}
        title="Go to the latest 2.x version" {{/**/ -}}
        href="{{ $latestUrlV2 }}">
      <i class="fa-solid fa-circle-play"></i>
      {{ .Site.Params.latestV2 }}
      <span class="text-success">(latest)</span>
    </a>
    {{ end -}}

    {{ if and $latestUrlV1 (or (ne $vMajor "1") (not $isLatest)) }}
    <a class="btn btn-sm btn-light border-0 border-start border-dark-subtle" {{/**/ -}}
        title="Go to the latest 1.x version" {{/**/ -}}
        href="{{ $latestUrlV1 }}">
      <i class="fa-regular fa-circle-play"></i>
      {{ .Site.Params.latest }}
      <span class="text-black-50">(archive)</span>
    </a>
    {{ end -}}
    </div>
</div>
<hr>
{{ end }}
