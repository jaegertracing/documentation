<!-- This renders the left-side menu panel -->
{{ $path := "" }}
{{ with .File }}
  {{ $path = .Path }}
{{ else }}
  {{ $path = .Path }}
{{ end }}
{{ $currentVersion := index (split $path "/") 1 }}
{{ $versionDocsPath := printf "content/docs/%s" $currentVersion }}
{{ $url := .RelPermalink }}
<div class="nav-wrapper">
  <aside class="nav">
    {{ range site.Pages }}
      {{ $pagePath := "" }}
      {{ with .File }}
        {{ $pagePath = .Path }}
      {{ else }}
        {{ $pagePath = .Path }}
      {{ end }}
      {{ $docVersion := index (split $pagePath "/") 1 }}
      {{ if and (eq $docVersion $currentVersion) (not .Params.hasParent) }}
        {{ $isCurrentPage := eq $url .RelPermalink }}
        <div class="nav-link">
          <a href="{{ .Permalink }}"{{ if $isCurrentPage }} class="is-active"{{ end }}>
            {{ if .Params.navtitle }}{{ .Params.navtitle }}{{ else }}{{ .Title }}{{ end }}
          </a>

          {{ with .Params.children }}
            {{ range . }}
              {{ $url := printf "/docs/%s/%s/" $currentVersion .url }}
              {{ $isCurrentPage := eq $url $.RelPermalink }}
              <br />
              <a class="nav-sublink{{ if $isCurrentPage }} is-active{{ end }}" href="{{ $url }}">
                &cir; {{ if .navtitle }}{{ .navtitle }}{{ else }}{{ .title }}{{ end }}
              </a>
            {{ end }}
          {{ end }}
        </div>
      {{ end }}
    {{ end }}
  </aside>
</div>
