{{ $latest        := site.Params.latest }}
{{ $latestV2      := site.Params.latestV2 }}
{{ $path := "" }}
{{ with .File }}
  {{ $path = .Path }}
{{ else }}
  {{ $path = .Path }}
{{ end }}
{{ $version       := index (split $path "/") 1 }}
{{ $vMajor        := index (split $version ".") 0 }}
{{ $isNextRelease := false }}
{{ if eq $version "next-release" }}
  {{ $vMajor = "1" }}
  {{ $isNextRelease = true }}
{{ else if eq $version "next-release-v2" }}
  {{ $vMajor = "2" }}
  {{ $isNextRelease = true }}
{{ end }}

{{ $isLatest      := or (eq $version $latest) (eq $version $latestV2) }}
{{ $latestUrlV1   := .RelPermalink | replaceRE $version $latest }}
{{ $latestUrlV2   := .RelPermalink | replaceRE $version $latestV2 }}

{{ $latestUrl     := "" }}
{{ if eq $vMajor "1" }}
  {{ $latestUrl     = .RelPermalink | replaceRE $version $latest }}
{{ else if eq $vMajor "2" }}
  {{ $latestUrl     = .RelPermalink | replaceRE $version $latestV2 }}
{{ end }}

<header>
  <p class="title is-1">{{ .Title }}</p>
  {{ with .Params.description }}
  <p class="subtitle is-3">{{ . }}</p>
  {{ end }}

  {{ if ne $path "docs" }}
    <div class="tags has-addons">
      <span class="tag is-medium">
        Version&nbsp;&nbsp;<strong>{{ $version }}</strong>
      </span>
      {{ if $isLatest }}
      <span class="tag is-medium is-success">Latest</span>
      {{ else if $isNextRelease }}
      <span class="tag is-medium is-info">
        Preview
      </span>
      {{ else }}
      <a class="tag is-medium is-warning" href="{{ $latestUrl }}">
        Go to the latest v{{ $vMajor }}.x version
      </a>
      {{ end }}
      {{ if eq $vMajor "1" }}
      <a class="tag is-medium" href="{{ $latestUrlV2 }}">
        Go to the latest v2.x version
      </a>
      {{ else if eq $vMajor "2" }}
      <a class="tag is-medium" href="{{ $latestUrlV1 }}">
        Go to the latest v1.x version
      </a>
      {{ end }}
        </div>
  {{ end }}

  <hr class="hr" />

  {{ if .Params.children }}
    <p>See also:</p>
    <ul>
      {{ range .Params.children }}
      {{ $url := printf "/docs/%s/%s/" $version .url }}
      <li>
        <a href="{{ $url }}">
          {{ .title }}
        </a>
      </li>
      {{ end }}
    </ul>
    <hr class="hr" />
  {{ end }}
</header>
